<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="None">
        <meta name="author" content="Burmeister Lab">
        
        <link rel="shortcut icon" href="img/favicon.ico">
        <title>genome analysis</title>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/fontawesome.min.css" rel="stylesheet">
        <link href="css/brands.min.css" rel="stylesheet">
        <link href="css/solid.min.css" rel="stylesheet">
        <link href="css/v4-font-face.min.css" rel="stylesheet">
        <link href="css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body class="homepage">
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href=".">genome analysis</a>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#genome-analysis" class="nav-link">Genome Analysis</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#gene-analysis-module-user-guide" class="nav-link">Gene Analysis Module User Guide</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#table-of-contents" class="nav-link">Table of Contents</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#overview" class="nav-link">Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#installation" class="nav-link">Installation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#prepare-your-data" class="nav-link">Prepare Your Data</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#configuration" class="nav-link">Configuration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#using-the-tool" class="nav-link">Using the Tool</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#output-formats" class="nav-link">Output Formats</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#prompts-and-elaboration-generation" class="nav-link">Prompts and Elaboration Generation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#handling-errors-and-rate-limiting" class="nav-link">Handling Errors and Rate Limiting</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#additional-notes" class="nav-link">Additional Notes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#directory-structure" class="nav-link">Directory Structure</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#license" class="nav-link">License</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#contact" class="nav-link">Contact</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="genome-analysis">Genome Analysis</h1>
<p><a href="https://cookiecutter-data-science.drivendata.org/"><img alt="CCDS-Project Template" src="https://img.shields.io/badge/CCDS-Project%20template-328F97?logo=cookiecutter" /></a></p>
<h2 id="gene-analysis-module-user-guide">Gene Analysis Module User Guide</h2>
<p>Welcome to the Gene Analysis Module! This tool is specifically designed to streamline the analysis of gene variant data, allowing you to generate insightful elaborations and produce cleanly formatted reports in both Markdown and PDF formats.</p>
<p>Given the vast number of genes, manually searching for information on each one related to your area of interest can be incredibly time-consuming. This is where our tool offers a significant advantage. By leveraging the ChatGPT API, you can expedite your research process by submitting questions related to specific genes involved in variant analysis. The tool queries the API to determine if a particular gene could be associated with the type of genetic variant analysis you are conducting, saving you invaluable time and effort.</p>
<p>This guide will walk you through the steps to use the Gene Analysis Module effectively, enabling you to make the most of its capabilities for your research endeavors.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#using-the-tool">Using the Tool</a></li>
<li><a href="#prepare-your-data">Prepare Your Data</a></li>
<li><a href="#generate-reports">Generate Reports</a></li>
<li><a href="#output-formats">Output Formats</a></li>
<li><a href="#prompts-and-elaboration-generation">Prompts and Elaboration Generation</a></li>
<li><a href="#handling-errors-and-rate-limiting">Handling Errors and Rate Limiting</a></li>
<li><a href="#additional-notes">Additional Notes</a></li>
<li><a href="#directory-structure">Directory Structure</a></li>
<li><a href="#license">License</a></li>
</ul>
<h2 id="overview">Overview</h2>
<p>The Gene Analysis Module is a Python-based tool that processes gene variant data in TSV (Tab-Separated Values) format. The module extracts relevant information such as gene symbols, allele frequencies, and variant consequences, then formats it for easy viewing. By leveraging the OpenAI API, the tool generates dynamic elaborations for gene symbols based on user-defined prompts. These elaborations provide deeper insights into gene variants, making the data more useful for researchers.</p>
<p>The module outputs the processed data in Markdown and PDF formats, making it easy to integrate into reports or documentation.</p>
<h2 id="installation">Installation</h2>
<p>To get started with the Gene Analysis Module, follow the installation steps below:</p>
<h3 id="access-the-arc-environment">Access the ARC Environment</h3>
<p>SSH into the ARC (Advanced Research Computing) system at the University of Michigan:</p>
<pre><code class="language-bash">ssh greatlakes.arc-ts.umich.edu
</code></pre>
<h3 id="load-and-activate-the-conda-environment">Load and Activate the Conda Environment</h3>
<p>Load the Conda module:</p>
<pre><code class="language-bash">module load python/anaconda
</code></pre>
<p>Activate the Conda environment that contains the necessary dependencies:
bash:</p>
<pre><code class="language-bash">conda activate gene-analysis-env
</code></pre>
<p>If the environment is not already created, you can create it by running:
bash</p>
<pre><code class="language-bash">conda create -n gene-analysis-env python=3.8 pandas numpy openai python-dotenv
conda activate gene-analysis-env
</code></pre>
<h3 id="clone-the-repository">Clone the Repository</h3>
<p>Clone this repository:</p>
<pre><code class="language-bash">git clone https://github.com/yang-a1/gen-analysis-module.git
</code></pre>
<h3 id="set-up-the-environment-configuration">Set Up the Environment Configuration</h3>
<p>Create a .env file in the root directory of the project, and add the following configuration variables:</p>
<pre><code class="language-ini">OPENAI_API_KEY=your-api-key
model=gpt-35-turbo
API_VERSION=2024-06-01
prompts_json_file=&quot;prompts.json&quot;
MAX_TOKENS_VALUE=150
TEMPERATURE_VALUE=0.7
</code></pre>
<p>Make sure to replace the placeholders with your actual OpenAI API key, organization value, and any required URLs for accessing Azure OpenAI. The above example can be found in gen_analysis.env.example.</p>
<h2 id="prepare-your-data">Prepare Your Data</h2>
<p>Place your TSV files (gene variant data) in the appropriate folder (<code>RAW_DATA_DIR</code>). The tool will process these files and generate detailed Markdown reports.<br />
Ensure that your dataset has the required columns, including <code>chromosome</code>, <code>position</code>, <code>allele</code>, <code>symbol</code>, <code>impact</code>, etc. You can configure which columns to extract by modifying the <code>process_file</code> function.</p>
<h2 id="configuration">Configuration</h2>
<h3 id="environment-variables">Environment Variables</h3>
<p>The module uses environment variables defined in the <code>.env</code> file. Here’s an explanation of each variable:</p>
<ul>
<li><strong>OPENAI_API_KEY</strong>: Required for interacting with OpenAI's API. You can obtain it by signing up on OpenAI's platform.</li>
<li><strong>model</strong>: Specifies the OpenAI model to use for generating elaborations. The default model is <code>gpt-35-turbo</code>, but you can use other models depending on your needs.</li>
<li><strong>API_VERSION</strong>: The version of the OpenAI API you're using. This is set to <code>2024-06-01</code> in the example.</li>
<li><strong>prompts_json_file</strong>: Path to the JSON file containing predefined prompts. The prompts are used to generate detailed elaborations on gene symbols.</li>
<li><strong>MAX_TOKENS_VALUE</strong>: The maximum number of tokens (words/characters) that OpenAI will generate in response to each prompt.</li>
<li><strong>TEMPERATURE_VALUE</strong>: Controls the creativity of the responses. A higher value (e.g., <code>0.7</code>) results in more creative responses, while a lower value (e.g., <code>0.3</code>) generates more predictable responses.</li>
</ul>
<h3 id="prompts-json-file">Prompts JSON File</h3>
<p>The <code>prompts.json</code> file should be structured as a dictionary, where each key is a prompt template, and the value is the corresponding prompt. For example:</p>
<pre><code class="language-json">{
    &quot;mouse_prompt&quot;: &quot;Provide a professional, detailed description of mouse phenotypes associated with {gene_symbol}.&quot;,
    &quot;omim_prompt&quot;: &quot;Provide a professional, detailed description of diseases associated with {gene_symbol} as found in OMIM/GeneCards.&quot;
}
</code></pre>
<p>In the above example, the <code>{gene_symbol}</code> placeholder will be replaced with the actual gene symbol when generating elaborations.</p>
<h2 id="using-the-tool">Using the Tool</h2>
<h3 id="prepare-your-data_1">Prepare Your Data</h3>
<p>To process your data, make sure your variant information is stored in a TSV file with the following columns (among others):</p>
<ul>
<li><strong>chromosome</strong>: Chromosomal location.</li>
<li><strong>position</strong>: Position on the chromosome.</li>
<li><strong>allele</strong>: Genetic variant (e.g., A/G).</li>
<li><strong>symbol</strong>: Gene symbol.</li>
<li><strong>gnomadg_af</strong>: Allele frequency from the gnomAD database.</li>
<li><strong>max_af</strong>: Maximum allele frequency across populations.</li>
<li><strong>impact</strong>: Impact of the variant (e.g., benign, pathogenic).</li>
<li><strong>hgvsg</strong>: The variant's HGVS string.</li>
<li><strong>clinical significance</strong>: The clinical significance of the variant.</li>
</ul>
<p>Ensure your data is placed in the directory specified by the <code>RAW_DATA_DIR</code> environment variable.</p>
<h3 id="generate-reports">Generate Reports</h3>
<p>Once your data is ready and the environment is configured, run the following command to process your files and generate the reports:</p>
<pre><code class="language-bash">python gen_analysis.py
</code></pre>
<p>This command will:
- Load the prompts from the <code>prompts.json</code> file.
- Process all TSV files in the <code>RAW_DATA_DIR</code> directory.
- Generate elaborations for each gene symbol.
- Output the results in Markdown format.
- Convert the Markdown files to PDF format using the custom CSS specified in <code>CSS_CONTENT</code>.</p>
<h2 id="output-formats">Output Formats</h2>
<h3 id="markdown-output">Markdown Output</h3>
<p>Each processed file will generate a <code>.md</code> file with the variant data formatted in Markdown. The file will include:</p>
<ul>
<li>A header with the filename.</li>
<li>Detailed variant information, including the elaborations generated for each gene symbol.</li>
<li>Specific variant details like allele frequencies, amino acid changes, and other relevant annotations.</li>
</ul>
<h3 id="pdf-output">PDF Output</h3>
<p>The <code>.md</code> files are converted to PDF format using a custom CSS file. This provides a clean and professional layout for presenting the data.</p>
<h2 id="prompts-and-elaboration-generation">Prompts and Elaboration Generation</h2>
<p>The module generates detailed elaborations for each gene symbol using OpenAI’s GPT-3 model. These elaborations provide insights into the gene’s function, potential variant impacts, and other relevant details. The elaborations are generated dynamically based on predefined prompts, which can be customized to suit your needs.</p>
<p>For example, if you have a gene symbol "BRCA1", the prompt might ask the model to generate a detailed description of BRCA1's function and its known variants.</p>
<h2 id="handling-errors-and-rate-limiting">Handling Errors and Rate Limiting</h2>
<h3 id="errors">Errors</h3>
<p>The tool includes error handling to manage issues such as:</p>
<ul>
<li>Missing or empty input files.</li>
<li>Incorrect file formats.</li>
<li>API errors.</li>
</ul>
<h3 id="rate-limiting">Rate Limiting</h3>
<p>If the tool encounters OpenAI’s rate limit (when too many requests are made in a short period), it will automatically pause for 60 seconds and retry the request. This ensures that the process can continue without interruption.</p>
<h2 id="additional-notes">Additional Notes</h2>
<ul>
<li><strong>Customizing Prompts</strong>: You can easily adjust the prompts in the <code>prompts.json</code> file to modify the elaborations generated by the OpenAI model.</li>
<li><strong>Large Data Files</strong>: If your TSV files contain more than 1000 lines, the tool will reject them to ensure that processing remains manageable. You can adjust the line limit by changing the <code>max_lines</code> parameter in the script.</li>
</ul>
<h2 id="directory-structure">Directory Structure</h2>
<h3 id="contrib"><code>contrib/</code></h3>
<p>This folder contains utility scripts and additional resources to aid users in executing analyses.</p>
<ul>
<li>
<p><strong><code>20241004_quickrun_gen_analysisV2.sh</code></strong>: A bash script that activates a conda environment and lists files in the raw data directory. It prompts the user for confirmation before running the <code>gen_analysis.py</code> script, which processes genetic data and generates reports in Markdown and DOCX formats.</p>
</li>
<li>
<p><strong><code>pandoc.sh</code></strong>: A simple script example for converting Markdown files to DOCX using Pandoc.</p>
</li>
<li>
<p><strong><code>rm_request_open_terminal.sh</code></strong>: A script to submit an interactive job to a SLURM scheduler, providing access to a terminal for executing commands.</p>
</li>
</ul>
<h3 id="gen_analysis_module"><code>gen_analysis_module/</code></h3>
<p>This module includes the core functionality for data processing and analysis.</p>
<ul>
<li>
<p><strong><code>config.py</code></strong>: Configures project directories and loads environment variables. Sets paths for raw, processed, and external data.</p>
</li>
<li>
<p><strong><code>dataset.py</code></strong>: Contains a command-line interface for processing datasets, with customizable input and output paths.</p>
</li>
<li>
<p><strong><code>features.py</code></strong>: Similar to <code>dataset.py</code>, this script generates features from processed datasets and allows for path customization.</p>
</li>
<li>
<p><strong><code>gen_analysis.py</code></strong>: The main analysis script that reads TSV files, processes genetic variant information, and generates elaborated descriptions using the OpenAI API.</p>
</li>
<li>
<p><strong><code>plots.py</code></strong>: A placeholder for future plotting functionalities, designed to generate visual representations of the processed data.</p>
</li>
</ul>
<h3 id="tests"><code>tests/</code></h3>
<p>This directory includes test cases to ensure the functionality of the project.</p>
<ul>
<li><strong><code>test_gen_analysis.py</code></strong>: Uses <code>pytest</code> to validate the existence of TSV files in the test data directory and tests the core functions for getting file paths and generating elaboration from prompts.</li>
</ul>
<h3 id="data"><code>data/</code></h3>
<p>Contains various test cases in the form of TSV files used for validating the functionality of the scripts. Notable files include:</p>
<ul>
<li><strong><code>empty.tsv</code></strong></li>
<li><strong><code>extracol.tsv</code></strong></li>
<li><strong><code>header.tsv</code></strong></li>
<li><strong><code>malformed.tsv</code></strong></li>
<li><strong><code>missingcol.tsv</code></strong></li>
<li><strong><code>test_file_1.tsv</code></strong></li>
<li><strong><code>test_file_2.tsv</code></strong></li>
</ul>
<h3 id="usage">Usage</h3>
<p>To run the analysis, follow these steps:
1. Navigate to the <code>contrib</code> directory.
2. Execute the <code>20241004_quickrun_gen_analysisV2.sh</code> script.
3. Confirm the continuation when prompted.
4. The analysis will be executed, generating outputs in the specified formats.</p>
<h3 id="slurm-job-management">SLURM Job Management</h3>
<p>The project includes guidelines for submitting jobs to SLURM, with a focus on managing job numbers and ensuring the correct environment is activated for execution.</p>
<h3 id="additional-notes_1">Additional Notes</h3>
<ul>
<li>Ensure that the necessary environment variables for the OpenAI API are set in the <code>.env</code> file.</li>
<li>For any issues related to the SLURM job environment, refer to the provided commands and troubleshooting steps.</li>
</ul>
<h3 id="project-organization">Project Organization</h3>
<pre><code>├── LICENSE            &lt;- Open-source license if one is chosen
├── Makefile           &lt;- Makefile with convenience commands like `make data` or `make train`
├── README.md          &lt;- The top-level README for developers using this project.
├── data
│   ├── external       &lt;- Data from third party sources.
│   ├── interim        &lt;- Intermediate data that has been transformed.
│   ├── processed      &lt;- The final, canonical data sets for modeling.
│   └── raw            &lt;- The original, immutable data dump.
│
├── docs               &lt;- A default mkdocs project; see mkdocs.org for details
│
├── models             &lt;- Trained and serialized models, model predictions, or model summaries
│
├── notebooks          &lt;- Jupyter notebooks. Naming convention is a number (for ordering),
│                         the creator's initials, and a short `-` delimited description, e.g.
│                         `1.0-jqp-initial-data-exploration`.
│
├── pyproject.toml     &lt;- Project configuration file with package metadata for gen_analysis_module
│                         and configuration for tools like black
│
├── references         &lt;- Data dictionaries, manuals, and all other explanatory materials.
│
├── reports            &lt;- Generated analysis as HTML, PDF, LaTeX, etc.
│   └── figures        &lt;- Generated graphics and figures to be used in reporting
│
├── requirements.txt   &lt;- The requirements file for reproducing the analysis environment, e.g.
│                         generated with `pip freeze &gt; requirements.txt`
│
├── setup.cfg          &lt;- Configuration file for flake8
│
└── gen_analysis_module                &lt;- Source code for use in this project.
    │
    ├── __init__.py    &lt;- Makes gen_analysis_module a Python module
    │
    ├── data           &lt;- Scripts to download or generate data
    │   └── make_dataset.py
    │
    ├── features       &lt;- Scripts to turn raw data into features for modeling
    │   └── build_features.py
    │
    ├── models         &lt;- Scripts to train models and then use trained models to make
    │   │                 predictions
    │   ├── predict_model.py
    │   └── train_model.py
    │
    └── visualization  &lt;- Scripts to create exploratory and results oriented visualizations
        └── visualize.py
</code></pre>
<h2 id="license">License</h2>
<p>This project is licensed under the MIT License. See the <code>LICENSE</code> file for details.</p>
<h2 id="contact">Contact</h2>
<p>If you have any questions or would like to get in touch, feel free to reach out to us via email:<br />
- delpropo@med.umich.edu<br />
- amyyan@umich.edu  </p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="js/base.js"></script>
        <script src="search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

<!--
MkDocs version : 1.6.1
Build Date UTC : 2025-04-08 18:08:49.750370+00:00
-->
